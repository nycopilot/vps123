#!/usr/bin/env bash

# ===================================================
#  MAHIM NETWORK CONSOLE - NEXT GEN ULTRA EDITION
#                     2025 Edition
# ===================================================
#  Original Creator: MahimOp
#  YouTube : https://www.youtube.com/@mahimxyz
#  Discord : https://discord.gg/zkDNdPpArS
# ===================================================

set -e

# Next-Gen Neon Color Theme
RESET="\e[0m"
BOLD="\e[1m"
DIM="\e[2m"
UNDERLINE="\e[4m"

CYAN="\e[96m"
BLUE="\e[94m"
PURPLE="\e[95m"
GREEN="\e[92m"
YELLOW="\e[93m"
RED="\e[91m"
WHITE="\e[97m"

NEON_GREEN="\e[38;5;82m"
NEON_PURPLE="\e[38;5;165m"
NEON_BLUE="\e[38;5;75m"
GLOW="\e[38;5;51m"
DANGER="\e[38;5;196m"

clear

# Epic Mahim Network Header
echo -e "${NEON_BLUE}"
cat << "EOF"
 ___      ___       __       __    __   __     ___      ___ 
|"  \    /"  |     /""\     /" |  | "\ |" \   |"  \    /"  |
 \   \  //   |    /    \   (:  (__)  :)||  |   \   \  //   |
 /\\  \/.    |   /' /\  \   \/      \/ |:  |   /\\  \/.    |
|: \.        |  //  __'  \  //  __  \\ |.  |  |: \.        |
|.  \    /:  | /   /  \\  \(:  (  )  :)/\  |\ |.  \    /:  |
|___|\__/|___|(___/    \___)\__|  |__/(__\_|_)|___|\__/|___|
                                                            
EOF
echo -e "${NEON_PURPLE}${BOLD}             NEXT GEN ULTRA EDITION - 2025${RESET}"
echo -e "${GLOW}             Advanced â€¢ Futuristic â€¢ Elite Automation${RESET}"
echo -e "${DIM}      Original Creator: ${BOLD}MahimOp${RESET} ${DIM}| YouTube: @mahimxyz${RESET}"
echo -e "${DIM}      Discord: https://discord.gg/zkDNdPpArS${RESET}"
echo -e "${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}\n"

# Utility Functions
progress() { echo -e "${NEON_GREEN}${BOLD}âž¤ $1${RESET}"; }
success() { echo -e "${GREEN}${BOLD}âœ“ $1${RESET}"; }
warning() { echo -e "${YELLOW}${BOLD}! $1${RESET}"; }
error() { echo -e "${RED}${BOLD}âœ˜ $1${RESET}"; }

print_box_header() {
    local text="$1"
    local color="${2:-$NEON_PURPLE}"
    echo -e "${color}${BOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
    echo -e "${color}${BOLD}â•‘${RESET} ${WHITE}${BOLD}$text$(printf '%*s' $((58 - ${#text})) '') ${color}${BOLD}â•‘${RESET}"
    echo -e "${color}${BOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}\n"
}

print_menu_option() {
    local num="$1"
    local text="$2"
    echo -e "${NEON_BLUE}   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${RESET}"
    echo -e "${NEON_BLUE}   â”‚${RESET} ${WHITE}${BOLD}[${NEON_GREEN}${num}${WHITE}]${RESET} ${YELLOW}${text}$(printf '%*s' $((48 - ${#text} - 3)) '') ${NEON_BLUE}â”‚${RESET}"
    echo -e "${NEON_BLUE}   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${RESET}"
}

# Main Menu
main_menu() {
    clear
    echo -e "${NEON_BLUE}"
    cat << "EOF"
 ___      ___       __       __    __   __     ___      ___ 
|"  \    /"  |     /""\     /" |  | "\ |" \   |"  \    /"  |
 \   \  //   |    /    \   (:  (__)  :)||  |   \   \  //   |
 /\\  \/.    |   /' /\  \   \/      \/ |:  |   /\\  \/.    |
|: \.        |  //  __'  \  //  __  \\ |.  |  |: \.        |
|.  \    /:  | /   /  \\  \(:  (  )  :)/\  |\ |.  \    /:  |
|___|\__/|___|(___/    \___)\__|  |__/(__\_|_)|___|\__/|___|
                                                            

EOF
    echo -e "${NEON_PURPLE}${BOLD}                DEVELOPMENT MANAGEMENT CONSOLE${RESET}\n"

    print_box_header "MAIN OPTIONS" $NEON_PURPLE

    print_menu_option "1" "IDX Tool Setup (Nix + QEMU Environment)"
    print_menu_option "2" "IDX VPS Maker (Remote Deployment)"
    print_menu_option "3" "Exit Console"

    echo -e "\n${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    read -p $'\e[93m\e[1m   Select Option [1-3]: \e[0m' op
    echo
}

# Main Loop
while true; do
    main_menu

    case $op in
        1)
            clear
            echo -e "${NEON_BLUE}"
            cat << "EOF"
 ___      ___       __       __    __   __     ___      ___ 
|"  \    /"  |     /""\     /" |  | "\ |" \   |"  \    /"  |
 \   \  //   |    /    \   (:  (__)  :)||  |   \   \  //   |
 /\\  \/.    |   /' /\  \   \/      \/ |:  |   /\\  \/.    |
|: \.        |  //  __'  \  //  __  \\ |.  |  |: \.        |
|.  \    /:  | /   /  \\  \(:  (  )  :)/\  |\ |.  \    /:  |
|___|\__/|___|(___/    \___)\__|  |__/(__\_|_)|___|\__/|___|
                                                            

                                                 
EOF
            print_box_header "IDX TOOL SETUP" $NEON_PURPLE

            progress "Initializing workspace cleanup..."
            cd ~ || exit 1
            rm -rf myapp flutter 2>/dev/null

            mkdir -p vps123
            cd vps123

            if [ ! -d ".idx" ]; then
                progress "Creating IDX development environment..."

                mkdir -p .idx
                cd .idx

                progress "Generating dev.nix configuration..."
                cat > dev.nix << 'EOF'
{ pkgs, ... }: {
  channel = "stable-24.05";

  packages = with pkgs; [
    unzip
    openssh
    git
    qemu_kvm
    sudo
    cdrkit
    cloud-utils
    qemu
    flutter
    dart
  ];

  env = {
    EDITOR = "nano";
  };

  idx = {
    extensions = [
      "Dart-Code.flutter"
      "Dart-Code.dart-code"
    ];
    workspace = {
      onCreate = {};
      onStart = {};
    };
    previews = {
      enable = true;
    };
  };
}
EOF

                success "IDX Tool Setup Complete!"
                echo -e "\n${GLOW}${BOLD}Location:${RESET} ${WHITE}~/vps123/.idx${RESET}"
                echo -e "${GLOW}${BOLD}Channel:${RESET}  ${WHITE}Nix Stable 24.05${RESET}"
                echo -e "${GLOW}${BOLD}Tools:${RESET}    ${WHITE}Flutter, Dart, QEMU, Git, SSH${RESET}\n"
            else
                warning "IDX environment already exists!"
                echo -e "   Path: ${WHITE}~/vps123/.idx${RESET}\n"
            fi

            echo -e "${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
            read -p $'\e[93mPress Enter to return...\e[0m' -r
            ;;

        2)
            clear
            echo -e "${NEON_PURPLE}"
            cat << "EOF"
 ___      ___       __       __    __   __     ___      ___ 
|"  \    /"  |     /""\     /" |  | "\ |" \   |"  \    /"  |
 \   \  //   |    /    \   (:  (__)  :)||  |   \   \  //   |
 /\\  \/.    |   /' /\  \   \/      \/ |:  |   /\\  \/.    |
|: \.        |  //  __'  \  //  __  \\ |.  |  |: \.        |
|.  \    /:  | /   /  \\  \(:  (  )  :)/\  |\ |.  \    /:  |
|___|\__/|___|(___/    \___)\__|  |__/(__\_|_)|___|\__/|___|
                                                            
                                         
EOF
            print_box_header "IDX VPS MAKER" $NEON_PURPLE

            progress "Fetching remote deployment script..."
            echo -e "\n${CYAN}Executing mahim Network Remote VPS Maker...${RESET}\n"

            if command -v bash >/dev/null && [ -f ~/script ]; then
                bash script
            else
                warning "Remote script not found locally."
                echo -e "   Please ensure the deployment script is available.\n"
            fi

            success "IDX VPS Maker execution finished."
            read -p $'\e[93mPress Enter to return...\e[0m' -r
            ;;

        3)
            clear
            echo -e "${DANGER}"
            cat << "EOF"
 ___      ___       __       __    __   __     ___      ___ 
|"  \    /"  |     /""\     /" |  | "\ |" \   |"  \    /"  |
 \   \  //   |    /    \   (:  (__)  :)||  |   \   \  //   |
 /\\  \/.    |   /' /\  \   \/      \/ |:  |   /\\  \/.    |
|: \.        |  //  __'  \  //  __  \\ |.  |  |: \.        |
|.  \    /:  | /   /  \\  \(:  (  )  :)/\  |\ |.  \    /:  |
|___|\__/|___|(___/    \___)\__|  |__/(__\_|_)|___|\__/|___|
                                                              
                                                 
EOF
            print_box_header "SESSION TERMINATED" $DANGER

            echo -e "\n${WHITE}${BOLD}   Thank you for using Mahim Network Console!${RESET}"
            echo -e "${YELLOW}${BOLD}           Made with â¤ï¸ by MahimOp${RESET}\n"

            echo -e "${NEON_GREEN}${BOLD}Original Creator: MahimOp${RESET}"
            echo -e "${DIM}YouTube: https://www.youtube.com/@mahimxyz${RESET}"
            echo -e "${DIM}Discord: https://discord.gg/zkDNdPpArS${RESET}\n"

            echo -e "${GLOW}${BOLD}See you in the next session, Operator! ðŸš€${RESET}\n"
            exit 0
            ;;

        *)
            clear
            print_box_header "INVALID SELECTION" $DANGER
            error "Please enter a valid option (1â€“3)"
            sleep 2
            ;;
    esac
done
